# 📚 [학습 주제] Google Docs의 통신 방식

## 🎯 학습 목표
- 이 내용을 왜 학습했는가? 공동 작업 문서를 다루는 노션, 피그마는 웹소켓을 이용하는데 구글 독스는 개발자 도구의 네트워크 탭에 웹소켓 프로토콜 정보가 보이지 않아서 어떤 방식으로 공동 작업을 하게 해주는지 궁금하여 학습했다.
- 학습 후 기대 결과: 구글 Docs에서 웹소켓을 사용하지 않고 어떤 방식을 채택했는지 설명할 수 있다.

## 📖 핵심 내용 요약
- 핵심 개념 1: Ajax
- 핵심 개념 2: 구글 독스의 방식 - bind, active, Ping, save
- 핵심 개념 3: HTTP Streaming의 원리

## ✍️ 상세 정리
### 개념 1: Ajax
설명:
- 브라우저의 XMLHttpRequest를 이용해 전체 페이지를 새로 가져오지 않고도 페이지 일부만을 변경할 수 있도록 javascript를 실행해 서버에 데이터만을 별도로 요청하는 기법이다. (JQuery는 비통기통신을 위해 ajax 함수를 제공하지만 Ajax 자체는 비통기 통신이라는 기술적 개념이다.)
- HTTP 프로토콜을 이용한 비동기 통신이며 브라우저는 정적 HTML 파일과 CSS파일, 데이터를 어떻게 요청하면 되는지를 설명한 javascript를 통해 HTML, CSS를 이용해 골격을 먼저 형성하고 Ajax 실행부가 담긴 javascript 영역을 실행하여 데이터를 별도로 가져와 적절한 방법으로 데이터를 끼워 넣은 후 페이지를 로딩한다.
- 이름에는 XML이 들어가지만 현재는 JSON 포맷이 더 효율적이기 때문에 JSON을 사용한다.
- 과거에는 `XMLHttpRequest`를 썼으나 현재는 더 간결한 `Fetch API`가 표준이다.

### 개념 2: 구글 독스의 방식
설명:
- bind: 서버와 클라이언트 사이의 통로를 여는 작업으로 응답을 즉시 종료하지 않고 연결을 유지하며 서버에서 오는 데이터(다른 사람의 편집 등)를 실시간으로 받는다.
<img width="530" height="326" alt="image" src="https://github.com/user-attachments/assets/68cfd019-8b1a-433a-b5d8-fa220c42be0a" />

- active: 현재 사용자가 해당 문서 탭을 보고 있는지를 판단할 수 있도록 서버에 보내주는 용도이다.
- Ping: 클라이언트와 서버 사이의 네트워크 연결 상태를 체크하는 용도로 세션이 끊기지 않게 유지하는 용도이다.
- save: 일정 간격으로 변경된 데이터를 묶어서 서버에 보내는 용도이다.

- 구글 독스의 방식
  - bind를 통해 HTTP Streaming으로 연결을 하는 방식을 채택했고 주기적으로 서버가 noop(No Operation)을 보내면서 연결을 유지한다.
  - 노션의 경우는 데이터베이스 블록 간의 연결성을 실시간 반영하기 위해 웹소켓으로 하는 것이 필요하고 피그마는 디자인 툴이므로 레이턴시를 매우 낮게 만들어야 하므로 웹소켓이 사실상 필수적이다. 하지만 구글 독스는 접근성이 최우선이기 때문에 작성된 내용을 보낼때는 비동기 Post를 작성된 내용을 받을 때는 HTTP Steaming을 통해 chunking 된 데이터를 받는다. (SSE는 규격 데이터 양식이 있어서 커스텀 HTTP Streaming 방식을 사용한다.)

### 개념 3: HTTP Streaming의 원리
설명:
- 클라이언트가 요청을 보내면 서버가 응답을 끝내지 않고 연결을 유지한 상태에서 데이터를 Chunk 단위로 계속해서 밀어주는 방식이다.
- 통신 흐름
  - 연결 수립: 클라이언트가 서버에 요청을 보내서 서버가 응답 헤더만 먼저 보내 연결을 열어둔다.
  - 데이터 조각 전송: 서버에 새로운 이벤트가 발생하면 서버는 열려 있는 연결 통로로 데이터 조각을 흘려보낸다.
  - 무한 루프 또는 재연결: 서버는 연결이 너무 오래되면 네트워크 장비에 의해 강제로 끊길 수 있기 때문에 일정 시간이 지나면 연결을 안전하게 닫고 클라이언트는 즉시 새 요청을 보내 재연결한다.