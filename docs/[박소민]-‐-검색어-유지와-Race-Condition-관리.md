# 🤔 [고민한 주제]
**검색어 유지와 페이지 이동이 충돌할 때 발생하는 'URL 좀비 버그' 해결 과정**

## 📝 고민 배경
- **왜 이 고민을 하게 되었는가?**: 
  검색 결과에서 특정 폴더나 문항을 클릭해서 다른 페이지로 넘어갔는데, 지워져야 할 검색어(`?keyword=`)가 URL에 스멀스멀 다시 나타나면서 엉뚱하게 다시 검색 결과 화면으로 튕겨버리는 버그(일명 좀비 버그)가 발생했습니다.
- **전제 조건**:
  - 문항 탭과 기업 탭을 왔다 갔다 할 때, 사용자가 전에 쳤던 검색어는 그대로 남아있어야 합니다 (UX 필수 요건).
- **제약 사항**: 
  - 리액트(React)는 화면을 그리는 속도와 URL이 바뀌는 속도, 데이터를 저장소(localStorage)에서 꺼내오는 속도가 미세하게 다릅니다. 이 타이밍이 꼬이면 무한 루프나 화면 깜빡임이 생기기 쉽습니다.

## 🔄 고려한 선택지

### 선택지 1: 클릭하는 버튼마다 "검색어 지우는 코드"를 직접 끼워 넣기
- **개념**: 사용자가 '폴더'나 '문항'을 클릭하는 순간, **페이지를 이동하기 직전에 강제로 검색창을 비우고(`setKeyword('')`) 저장된 검색어 기록도 지워버리는(`localStorage.removeItem()`)** 방법입니다. 방을 나가기 직전에 억지로 바닥을 닦고 나가는 것과 같습니다.
- **장점**: 당장 눈앞에 보이는 버그를 제일 빠르고 직관적으로 고칠 수 있습니다.
- **단점**: 나중에 '클릭할 수 있는 다른 버튼'이 추가되면, 개발자가 깜빡하고 이 지우는 코드를 안 넣을 수 있습니다. 그러면 똑같은 버그가 또 터지게 됩니다 (근본적인 해결책이 아님).

### 선택지 2: 페이지에 처음 들어올 때 딱 한 번만 검색어 복원하기
- **개념**: 컴포넌트가 처음 화면에 나타날 때(Mount) 딱 한 번만 저장소에서 검색어를 꺼내오고, 그 뒤로는 아예 간섭하지 않는 방법입니다.
- **장점**: 코드가 제일 단순해지고, 여러 로직이 엉키지 않아서 에러가 날 확률이 거의 없습니다.
- **단점**: '문항 탭 -> 기업 탭 -> 문항 탭'으로 탭만 바꿨을 때는 화면이 새로고침되지 않으므로, 이전에 쳤던 검색어가 전부 다 날아가 버려 사용자가 불편해집니다.

### 선택지 3: 탭 전환 시 '로딩 상태(스켈레톤)'를 활용해 순서대로 처리하기 (최종 선택)
- **개념**: 사용자가 탭을 누르는 순간 바로 화면을 보여주지 않고 1) 잠깐 로딩 화면을 띄운 뒤 -> 2) 저장소에서 검색어를 꺼내 URL과 검색창에 채워 넣고 -> 3) 세팅이 다 끝나면 짜잔! 하고 진짜 화면을 보여주는 방법입니다.
- **장점**: 타이밍이 꼬여서 버그가 생기는 일을 완벽하게 막아줍니다. 로딩 화면(스켈레톤) 덕분에 화면이 덜컥거리는 느낌도 없습니다.
- **단점**: 로딩 중인지 아닌지를 기억하는 변수(`isTransitioning`)를 하나 더 만들어야 해서 코드가 조금 길어집니다.

## ⚖️ 비교 정리

| 항목 | 선택지 1 (클릭할 때마다 지우기) | 선택지 2 (처음에 한 번만 복원하기) | 선택지 3 (로딩 화면 띄우고 순서대로 세팅하기) |
|------|----------|----------|----------|
| **구현 난이도** | 쉬움 (땜질식 처방) | 제일 쉬움 | 약간 어려움 (흐름을 제어해야 함) |
| **유지보수성** | 나쁨 (다른 곳에서 또 실수할 수 있음) | 좋음 | **아주 좋음 (로직이 한곳에 모여있음)** |
| **사용자 경험(UX)**| 보통 (화면 깜빡일 수 있음) | 나쁨 (검색어가 자꾸 날아감) | **최상 (스켈레톤으로 부드럽게 넘어감)** |

## ✅ 최종 선택
- **선택한 방안**: 선택지 3 (탭 전환 시 로딩 상태를 활용한 순서 제어)
- **선택 이유**: 
  버그가 발생하는 진짜 이유는 **'페이지 이동'과 '검색어 복원'이 동시에 일어나면서 서로 충돌했기 때문**입니다. 이를 해결하기 위해 클릭 이벤트마다 땜질을 하는(선택지 1) 대신, 아예 "탭을 바꿀 때는 안전하게 화면을 가리고(로딩), 뒤에서 검색어 세팅을 다 끝낸 다음 화면을 연다"라는 규칙을 만들었습니다. 이렇게 하면 코드가 훨씬 튼튼해지고(안정성), 사용자도 뚝뚝 끊기는 화면을 보지 않아도 되어(UX) 가장 이상적인 해결책이라고 판단했습니다.

## 📉 아쉬운 점
- **포기한 부분**: 탭을 누르자마자 0.001초 만에 화면이 딱! 바뀌는 즉각적인 전환은 포기했습니다. 안전한 세팅을 위해 약 0.05초 정도의 아주 짧은 로딩 시간을 인위적으로 주었습니다.

## 🔮 이후 개선 방향
- **추후 다시 고려할 사항**:
  지금은 `setTimeout`이라는 타이머 함수를 써서 인위적으로 0.05초를 기다리게 했지만, 나중에는 React 18 버전에 있는 `useTransition`이라는 최신 기능을 써서 "리액트야, 뒷단에서 세팅 다 끝나면 알아서 부드럽게 화면 넘겨줘!" 하고 맡기는 방식으로 코드를 더 멋지게 다듬어보고 싶습니다.
